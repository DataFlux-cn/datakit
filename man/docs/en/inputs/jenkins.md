
# Jenkins
---

:fontawesome-brands-linux: :fontawesome-brands-windows: :fontawesome-brands-apple: :material-kubernetes: :material-docker:  · [:fontawesome-solid-flag-checkered:](index.md#legends "支持选举")

---

The Jenkins collector monitors Jenkins through plugin `Metrics` data collection, including but not limited to the number of tasks, system cpu usage, `jvm cpu` usage, and so on

## Preconditions {#requirements}

- JenKins version >= 2.277.4
- Install JenKins [see here](https://www.jenkins.io/doc/book/installing/){:target="_blank"}
- Download the `Metric` plug-in, [management plug-in page](https://www.jenkins.io/doc/book/managing/plugins/){:target="_blank"},[Metric plug-in page](https://plugins.jenkins.io/metrics/){:target="_blank"}
- Generate `Metric Access keys` on the JenKins administration page `your_manage_host/configure`

## Configuration {#config}

=== "Host Installation"

    Go to the `conf.d/jenkins` directory under the DataKit installation directory, copy `jenkins.conf.sample` and name it `jenkins.conf`. Examples are as follows:
    
    ```toml
        
    [[inputs.jenkins]]
      ## Set true if you want to collect metric from url below.
      enable_collect = true
    
      ## The Jenkins URL in the format "schema://host:port",required
      url = "http://my-jenkins-instance:8080"
    
      ## Metric Access Key ,generate in your-jenkins-host:/configure,required
      key = ""
    
      ## Set response_timeout
      # response_timeout = "5s"
    
      ## Optional TLS Config
      # tls_ca = "/xx/ca.pem"
      # tls_cert = "/xx/cert.pem"
      # tls_key = "/xx/key.pem"
      ## Use SSL but skip chain & host verification
      # insecure_skip_verify = false
    
      ## set true to receive jenkins CI event
      enable_ci_visibility = true
    
      ## which port to listen to jenkins CI event
      ci_event_port = ":9539"
    
      # [inputs.jenkins.log]
      # files = []
      # #grok pipeline script path
      # pipeline = "jenkins.p"
    
      [inputs.jenkins.tags]
      # some_tag = "some_value"
      # more_tag = "some_other_value"
      # ...
    
      [inputs.jenkins.ci_extra_tags]
      # some_tag = "some_value"
      # more_tag = "some_other_value"
    
    ```
    
    Once configured, [restart DataKit](datakit-service-how-to.md#manage-service).

=== "Kubernetes"

    The collector can now be turned on by [ConfigMap Injection Collector Configuration](datakit-daemonset-deploy.md#configmap-setting).

## Jenkins CI Visibility {#ci-visibility}

The Jenkins collector can realize CI visualization by receiving the CI Event from the Jenkins datadog plugin.

Jenkins CI Visibility opening method:

- Ensure that the Jenkins CI Visibility feature is turned on in the configuration file and the listening port number is configured (such as `:9539`), restart Datakit;
- Install [Jenkins Datadog plugin](https://plugins.jenkins.io/datadog/){:target="_blank"}  in Jenkins;
- Select `Use the Datadog Agent to report to Datadog (recommended)` in Manage Jenkins > Configure System > Datadog Plugin and configure `Agent Host` as the Datakit IP address. Both `DogStatsD Port` and `Traces Collection Port` are configured to the port number configured in the Jenkins collector configuration file above, such as `9539`(do not add `:`);
- Check `Enable CI Visibility`；
- Click `Save` to Save the settings.

After configuration, Jenkins can send CI events to Datakit through Datadog Plugin.

## Measurements {#measurements}

For all of the following data collections, a global tag named `host` is appended by default (the tag value is the host name of the DataKit).
You can specify additional labels for collected metrics in the configuration by `[inputs.jenkins.tags]`:

``` toml
 [inputs.jenkins.tags]
  # some_tag = "some_value"
  # more_tag = "some_other_value"
  # ...
```

You can specify additional tags for the Jenkins CI Event in the configuration by `[inputs.jenkins.ci_extra_tags]`:

```toml
 [inputs.jenkins.ci_extra_tags]
  # some_tag = "some_value"
  # more_tag = "some_other_value"
```

{{ range $i, $m := .Measurements }}

### `{{$m.Name}}`

- tag

{{$m.TagsMarkdownTable}}

- metric list

{{$m.FieldsMarkdownTable}}

{{ end }}


## Log Collection {#logging}

To collect the JenKins log, open `files` in JenKins.conf and write to the absolute path of the JenKins log file. For example:

```toml
    [[inputs.JenKins]]
      ...
      [inputs.JenKins.log]
        files = ["/var/log/jenkins/jenkins.log"]
```


When log collection is turned on, a log with a log `source` of `jenkins` is generated by default.

>Note: DataKit must be installed on the host where JenKins is located to collect JenKins logs.

## Log Pipeline Feature Cut Field Description {#pipeline}

- JenKins Universal Log Cutting

Example of common log text:
```
2021-05-18 03:08:58.053+0000 [id=32] INFO jenkins.InitReactorRunner$1#onAttained: Started all plugins
```

The list of cut fields is as follows:

| Field Name | Field Value              | Description                         |
| ---    | ---                 | ---                          |
| status | info                | log level                     |
| id     | 32                  | id                           |
| time   | 1621278538000000000 | Nanosecond timestamp (as row protocol time) |
