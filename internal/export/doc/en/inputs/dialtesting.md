---
title     : 'Diatesting'
summary   : 'Obtain network performance through network dialing test'
__int_icon      : 'icon/dialtesting'
dashboard :
  - desc  : 'N/A'
    path  : '-'
monitor   :
  - desc  : 'N/A'
    path  : '-'
---

<!-- markdownlint-disable MD025 -->
# Network Dial Test
<!-- markdownlint-enable -->
---

{{.AvailableArchs}}

---

The collector collects the data of network dialing test results, and all the data generated by dialing test are reported to Guance Cloud.

## Configuration {#config}

### Environment Variables {#env}

By default, the dialtesting service can dial up any network, which may pose certain security risks. If you need to prohibit to connect to certain network, you can restrict it by setting the following environmental variables:


|  Environment variable name     |  Parameter example | Description |
| :----------------------------- | ------------------ | ------------ |
| `ENV_INPUT_DIALTESTING_DISABLE_INTERNAL_NETWORK_TASK`      |  `true`             | Enable or disable internal network dialing test. Default is `false`|
| `ENV_INPUT_DIALTESTING_DISABLED_INTERNAL_NETWORK_CIDR_LIST`      |  `["192.168.0.0/16"]`             | List of network CIDRs that prohibit testing, which supports multiple entries. If left empty, all private networks will be disabled. |
| `ENV_INPUT_DIALTESTING_ENABLE_DEBUG_API`      |  `false`             | Enable or disable the debug API. |

### Private Test Node Deployment {#private-deploy}

<!-- markdownlint-disable MD046 -->
=== "host installation"

    To deploy private dial-test nodes, you need to [create private dial-test nodes on Guance Cloud page](../usability-monitoring/self-node.md). When you're done, fill in the page with the relevant information in `conf.d/{{.Catalog}}/{{.InputName}}.conf`:
    
    Go to the `conf.d/{{.Catalog}}` directory under the DataKit installation directory, copy `{{.InputName}}.conf.sample` and name it `{{.InputName}}.conf`. Examples are as follows:
    
    ```toml
    {{ CodeBlock .InputSample 4 }}
    ```
    
    Once configured, [restart DataKit](../datakit/datakit-service-how-to.md#manage-service).

=== "Kubernetes"

    The collector can now be turned on by [ConfigMap injection collector configuration](../datakit/datakit-daemonset-deploy.md#configmap-setting).

---

???+ attention

    Currently, only Linux dial-up nodes support, and the tracing data is stored in the [traceroute](#fields) field of the relevant metrics.
<!-- markdownlint-enable -->

### Dial Test Deployment Map {#arch}

<figure markdown>
  ![dialtesting-net-arch](https://static.guance.com/images/datakit/dialtesting-net-arch.png){ width="800" }
</figure>

## Metric {#metric}

Dialtesting collector could expose some [Prometheus metrics](../datakit/datakit-metrics.md). You can upload these metrics to Guance Cloud through [Datakit collector](dk.md). The relevant configuration is as follows:

```toml
[[inputs.dk]]
  ......

  metric_name_filter = [
  
  ### others...
  
  ### dialtesting
  "datakit_dialtesting_.*",

  ]

  ......

```

## Log {#logging}

All of the following data collections are appended with a global tag named `host` by default (the tag value is the host name of the DataKit), or can be named in the configuration by `[[inputs.{{.InputName}}.tags]]` alternative host.

{{ range $i, $m := .Measurements }}

### `{{$m.Name}}`

- tag

{{$m.TagsMarkdownTable}}

- metric list

{{$m.FieldsMarkdownTable}}

{{ end }}


### `traceroute` Field Description {#fields}

traceroute is the JSON text of the "route trace" data, and the entire data is an array object in which each array element records a route probe, as shown in the following example:

```json
[
    {
        "total": 2,
        "failed": 0,
        "loss": 0,
        "avg_cost": 12700395,
        "min_cost": 11902041,
        "max_cost": 13498750,
        "std_cost": 1129043,
        "items": [
            {
                "ip": "10.8.9.1",
                "response_time": 13498750
            },
            {
                "ip": "10.8.9.1",
                "response_time": 11902041
            }
        ]
    },
    {
        "total": 2,
        "failed": 0,
        "loss": 0,
        "avg_cost": 13775021,
        "min_cost": 13740084,
        "max_cost": 13809959,
        "std_cost": 49409,
        "items": [
            {
                "ip": "10.12.168.218",
                "response_time": 13740084
            },
            {
                "ip": "10.12.168.218",
                "response_time": 13809959
            }
        ]
    }
]
```

**Field description:**

| Field  | Type      | Description            |
| :---       | ---           | ---                         |
| `total`    | number        | Total number of detections |
| `failed`   | number        | Number of failures  |
| `loss`     | number        | Percentage of failure |
| `avg_cost` | number        | Average time spent (μs) |
| `min_cost` | number        | Minimum time consumption (μs) |
| `max_cost` | number        | Maximum time consumption(μs) |
| `std_cost` | number        | Standard deviation of time consumption(μs) |
| `items`    | Array of items | Per probe information ([see](dialtesting.md#item)) |

### Item {#item}

| Field           | Type   | Description                             |
| :-------------- | ------ | --------------------------------------- |
| `ip`            | string | IP address, if it fails, the value is * |
| `response_time` | number | Response time (μs)                      |

